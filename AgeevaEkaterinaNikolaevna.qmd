---
title: "HW_4"
author: "AgeevaEN"
format: html
editor: visual
---

```{r}
install.packages("qqplotr")
install.packages("DescTools")
install.packages("vcd")
library(tidyverse)
library(psych)
library(qqplotr)
library(vcd)
library(gridExtra)
```

**Задание 1** Рассмотрите следующую статистическую гипотезу.

Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

Задайте seed для воспроизводимости результатов (функция set.seed()). Задайте размер выборки sample_size \<- 30. Задайте значение среднего артериального давления до приема нового препарата и после.

```{r}
set.seed(500)
sample_size <- 30

pressure_medium_before <- 145
pressure_medium_after <- 115

pressure_before <- rnorm(sample_size, pressure_medium_before, sd=3)

pressure_after <- rnorm(sample_size, pressure_medium_after, sd=3)

df <- data.frame(PB = pressure_before, PA = pressure_after)

head(df)
```

Сформулируйте нулевую и альтернативную гипотезы.

H0 - новый препарат никак не отличается по влиянию на давление по сравнению со стандартной терапией. H1 - новый препарат в среднем лучше снижает давление по сравнению со стандартной терапией.

Определите уровень значимости.

```{r}
alpha = 0.05
```

Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор. Чтобы выбрать стат. тест сначала изучаем нашу выборку на нормальность распределения

1.  Визуальный метод

```{r}
hist(pressure_before, col='steelblue', main='Визуальная оценка')
hist(pressure_after, col='steelblue', main='Визуальная оценка')
```

Визуально распределение выглядят не идеально.

Еще один метод графического представления данных - график QQ

```{r}
qqnorm(pressure_before, main='Визуальная оценка')
qqline(pressure_before)

qqnorm(pressure_after, main='Визуальная оценка')
qqline(pressure_after)
```

Так же, как и гистограммы, стремится к нормальному распределению.

2.  тест Шапиро-Уилка на нормальность распределения H0 - распределение нормальное H1 - распределение отлично от нормального

```{r}
shapiro.test(df$PB)
shapiro.test(df$PA)
```

Согласно тесту Шапиро-Уилка в обоих случаях p-value больше установленнной альфа(0,05), а следовательно мы не может отклонить нулевую гипотезу. Мы ее принимаем. Распределение в обоих случаях нормально.

Далее нам необходимо понять выборки зависимые или независимые.

Для зависимых выборок пойдет t-test.

```{r}
t.test(pressure_before, pressure_after, paired = TRUE)
```

Поскольку P-value меньше заданного значения альфа, мы можем отклонить нудевую гипотезу и принимаем альтернативную, согласно которой новый препарат в среднем лучше снижает давление по сравнению со стандартной терапией.

Определите наблюдаемое значение статистики, а также критическое значение статистики.

```{r}
qt(1 - alpha/2, df = 29)

# p-value < 2.2e-16
```
Итог:

Оцените и прокомментируйте статистическую значимость.

95% доверительный интервал для двух выборок находится в диапазоне:
          28.49513 - 32.11143
Количество степеней свободы - 29
Значение t статистики- t = 34.277
Средняя разница - 30.30328 

Наблюдаемое значение статистики t = 34.27 превышает критическое значение 2.045 для 29 степеней свободы при уровне значимости 0.05.

p-value < alpha мы отвергаем Н0 и принимаем H1 - новый препарат в среднем лучше снижает давление по сравнению со стандартной терапией.

95% доверительный интервал не включает ноль, что подтверждает значимость различия средних.

**Задание 2**

Рассмотрите следующую статистическую гипотезу.

Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2


Рассмотрите два случая: для выборки sample_size1 <- 100 и выборки sample_size2 <- 30. Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.
```{r}
sample_size1 <- 100
sample_size2 <- 30
data_sample1 <- rep(c(1:0), each = 50) # 1- курит, 0 - не курит
data_sample2 <- rep(c(1:0), each = 15) # 1- курит, 0 - не курит


set.seed(50) 
cancer_true1 <- rbinom(50, 1, 0.8)
cancer_false1 <- rbinom(50, 1, 0.2)


set.seed(50) 
cancer_true2 <- rbinom(15, 1, 0.8)
cancer_false2 <- rbinom(15, 1, 0.2)

cancer1 <- c(cancer_true1, cancer_false1)
cancer2 <- c(cancer_true2 , cancer_false2)


df100 <- data.frame(Smoking = data_sample1,
                        Cancer = cancer1)

df30 <- data.frame(Smoking = data_sample2,
                        Cancer = cancer2)


```
 Сформулируйте нулевую и альтернативную гипотезы.
 
Н0 - курение не влияет на возникносение ракак легких
Н1 - курение влияет на возникновение рака легких

Определите уровень значимости.
```{r}
alpha = .05

```
Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

Тип данных: категориальный 
количество групп: 2; 
связанность групп: не связаны;

Можно использовать хи-квадрат Пирсона.

```{r}

library(vcd)
table100 <- table(df100$Smoking, df100$Cancer)

table30 <- table(df30$Smoking, df30$Cancer)

table100


```
```{r}
chisq_test1 <- chisq.test(table(df100$Smoking, df100$Cancer))
print(chisq_test1)

chisq_test2 <- chisq.test(table(df30$Smoking, df30$Cancer))
print(chisq_test2)

```
Определите наблюдаемое значение статистики, а также критическое значение статистики.
Оцените и прокомментируйте статистическую значимость.

Для sample_size1 = 100:
p-value меньше уровня значимости (альфа = 0,05).
Поэтому мы отвергаем нулевую гипотезу Н0 - курение не влияет на возникновение рака легких.
Это говорит о том, что существует статистически значимая связь между статусом курения и вероятностью развития рака легких в выборке из 100 человек.

Для sample_size2 = 30:
p-value меньше уровня значимости (альфа = 0,05).
Поэтому мы отвергаем нулевую гипотезу Н0 - курение не влияет на возникновение рака легких.
Это говорит о том, что существует статистически значимая связь между статусом курения и вероятностью развития рака легких в выборке из 30 человек.

Согласно данным, полученным стат тестом Хи квадрат можно предположить, что иммется связь между курением и развитием рака легких.

**Задание 3** 

Рассмотрите следующую статистическую гипотезу.

Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

Исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение.
```{r}
set.seed(123)

treatment_group <- rnorm(50, mean = 3, sd = 1.5)  


diet_group <- rnorm(50, mean = 2.5, sd = 1.2)  

df_pain <- data.frame(
  Treatment = c(rep("New Treatment", 50), rep("Diet Therapy", 50)),
  Pain_Level = c(treatment_group, diet_group)
)

```


1. Сформулируйте нулевую и альтернативную гипотезы.

H0 - Применение нового метода лечения СРК никак не влияет на уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

H1 - Применение нового метода лечения СРК значимо меняет уровень уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

Определите уровень значимости.
```{r}
alpha = .05
```

Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

Для сравнения уровня болевых симптомов между двумя группами возьмем U-критерий Манна-Уитни – это непараметрический статистический
критерий, использующийся для сравнения выраженности показателей в двух
несвязных выборках. 
-Подходит для независимых выборок;
-Не требует предположений о нормальности распределения данных;
-Использует ранговые значения данных для сравнения между группами.

```{r}

wilcox_test <- wilcox.test(Pain_Level ~ Treatment, data = df_pain)
observed_statistic <- wilcox_test$statistic
critical_value <- wilcox_test$statistic

print(paste("Observed Test Statistic:", observed_statistic))
print(paste("Critical Value:", critical_value))
print(wilcox_test)
```
Определите наблюдаемое значение статистики, а также критическое значение статистики.
Оцените и прокомментируйте статистическую значимость.

Наблюдаемое значение статистики W равно 1062.
P-value (0.1962) >  alpha (0.05), что не позволяет нам отвергать нулевую гипотезу о том. Мы ее принимаем: H0 - Применение нового метода лечения СРК никак не влияет на уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.


**Задание 4**

Рассмотрите следующую гипотезу.

Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей. В каждой из трех групп по 10 мышей.  Оценивается размер опухоли у мыши.
Сгенерируйте датасет следующим образом:
```{r}
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)
```

Постройте на одном графике три “ящика с усами” для наглядности.

```{r}

library(ggplot2)

ggplot(tumor, aes(x = therapy, y = value, fill = therapy)) +
  geom_boxplot() +
  labs(title = "Tumor Values by Therapy Type",
       x = "Therapy Type",
       y = "Tumor Value") +
  theme_minimal()
```

Проведите дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах.
H0 - статистически значимой разница между группами нет
H1 - между группами есть статистически значимая разница.

```{r}
alpha = .05
anova_result <- aov(value ~ therapy, data = tumor)

summary(anova_result)
```
Прокомментируйте получившийся результат.

Дисперсионный анализ сравнивает размер опухоли между всеми группами.

Значение p-value > alpha (0.05). Можно сделать вывод об отсутствии статистически значимых различий в размере опухоли между группами.

с помощью функции TukeyHSD() проведите попарные сравнения, используя критерий Тьюки. 
```{r}
tukey_results <- TukeyHSD(anova_result)

print(tukey_results)
```

Прокомментируйте полученные результаты.
Значение p-value между группами во всех вариантах > 0.05, а значит статистически значимых различий нет. Мы не можем отвергнуть нулевую гипотезу. Мы ее принимаем - статистически значимых различий в размере опухоли между группами нет.